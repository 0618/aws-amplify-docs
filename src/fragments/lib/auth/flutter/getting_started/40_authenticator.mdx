## Authentication with Amplify

There are 2 options to add authentication capabilities to your application:
- Option 1: Use Authenticator UI Library
- Option 2: Call Authentication APIs manually

## Option 1: Use Authenticator UI Library

<Callout>

Authenticator for Flutter is in developer preview.

</Callout>

The Flutter Authenticator library allows you to quickly create an authentication/registration flow within your app. The experience generated within your app will be determined by the `amplifyconfiguration.dart` file that is automatically generated for you after initializing your app, and adding auth or other categories. Here is an [example app](https://github.com/aws-amplify/amplify-flutter/tree/main/packages/amplify_authenticator/example) that utilizes Authenticator.

First, you need to add Authenticator as a dependency in your `pubspec.yaml` file in your root folder of your app. 
```dart
dependencies:
  amplify_flutter: ^0.3.0
  amplify_auth_cognito: ^0.3.0
  amplify_authenticator: *_NEED VERSION NUMBER_*
```
Second, you will have to import the authenticator at the top of your `./lib/main.dart` file:
```dart
import 'package:amplify_authenticator/amplify_authenticator.dart';
```
Thirdly, you will need to update the build method in the default Flutter app’s state in your `./lib/main.dart` file. The child of your Authenticator widget will be the widget that is rendered after your users successfully login:

```dart
@override
Widget build(BuildContext context) {
  final authenticator = Authenticator(
    child: const Scaffold(
      body: Center(child: Text('You are logged in!')),
    ),
  );

  return MaterialApp(
    title: 'Authenticator Demo',
    theme: ThemeData.light(),
    darkTheme: ThemeData.dark(),
    // The Authenticator component should be a descendant of your MaterialApp.
    home: authenticator,
  );
}
```
With these 3 simple steps, the basic Authenticator setup is complete.




### Theming/Styling Authenticator

By default, the Authenticator uses your app's Material theme for its styling. Any customizations you make to colors, buttons, input widgets, etc. will be reflected by the Authenticator.

```dart
return MaterialApp(
  title: 'Authenticator Demo',
  theme: ThemeData.from(
    colorScheme: ColorScheme.fromSwatch(
      primarySwatch: Colors.red,
      backgroundColor: Colors.white,
    ),
  ).copyWith(
    indicatorColor: Colors.red,
  ),
  darkTheme: ThemeData.from(
    colorScheme: ColorScheme.fromSwatch(
      primarySwatch: Colors.red,
      backgroundColor: Colors.black,
      brightness: Brightness.dark,
    ),
  ),
  home: authenticator,
);
```
![flutter-red-authenticator](/images/lib/getting-started/flutter/red_authenticator_flutter.png)

However, you can also use the a hand-crafted Amplify theme by setting `useAmplifyTheme` to `true`. This gives you a starting theme which is unique from the default Material theme.

```dart
return MaterialApp(
  title: 'Authenticator Demo',
  theme: ThemeData.light(),
  darkTheme: ThemeData.dark(),
  home: Authenticator(
    useAmplifyTheme: true,
    child: const Scaffold(
    body: Center(
        child: Text('You are logged in!')
    ),
),
  ),
);
```

![flutter-amplify-theme-authenticator](/images/lib/getting-started/flutter/authenticator_Amplify_theme_flutter_signin.png)

And, of course, both light and dark modes are supported!

![flutter-dark-theme-authenticator](/images/lib/getting-started/flutter/authenticator_dark_theme_flutter_signin.png)

### Customizing forms

The Authenticator allows you to customize the `SignUp`, `SignIn` and `ConfirmSignInNewPassword` forms by using predefined form fields provided by Amazon Cognito, or by adding your own fields, which could include customized messaging and field validation. 

To add a pre-defined form field, update your call to the Authenticator constructor:

```dart
String? _validateUsername(UsernameInput? input) {
  final username = input?.username;
  if (username == null || username.isEmpty) {
    return 'Username cannot be empty';
  }

  bool containsAmplify = username.contains('amplify');
  if (!containsAmplify) {
    return 'Username needs to include amplify';
  }

  return null;
}

final authenticator = Authenticator(
  signUpForm: SignUpForm.custom(
    fields: [
      SignUpFormField.username(
        validator: _validateUsername,
      ),
      SignUpFormField.password(),
      SignUpFormField.passwordConfirmation(),
    ],
  ),
  child: const Scaffold(
    body: Center(child: Text('You are logged in!')),
  ),
);
```

To add a custom form field that is not available in the pre-defined list provided by Cognito:

```dart
final authenticator = Authenticator(
  signUpForm: SignUpForm.custom(
    fields: [
      SignUpFormField.username(
        validator: _validateUsername,
      ),
      SignUpFormField.password(),
      SignUpFormField.passwordConfirmation(),

      // Example custom field
      SignUpFormField.custom(
          title: 'Favorite book',
          attributeKey:
              const CognitoUserAttributeKey.custom('favoritebook'),
          hintText: 'Enter your favorite book',
      ),
    ],
  ),
  child: const Scaffold(
    body: Center(child: Text('You are logged in!')),
  ),
);
```

### Text overrides and internationalization

The text displayed in the Authenticator is customizable and compatible with Flutter's out-of-the-box internationalization APIs.

#### Simple text customization

It is not necessary to do full fledged localization to customize components within the Authenticator. Below is a simple demonstration:

```dart
class LocalizedButtonResolver extends ButtonResolver {
  const LocalizedButtonResolver();

  @override
  String signin(BuildContext context) {
    //the text of the signin button can be customized
    return 'Login to Amplify';
  }
}

class LocalizedInputResolver extends InputResolver {
  const LocalizedInputResolver();

  @override
  String title(BuildContext context, InputField field) {
    switch (field) {
      case InputField.username:
        return 'Custom Username Title';
      case InputField.email:
        return 'Custom Email Title';
      case InputField.password:
        return 'Custom Password Title';
      case InputField.passwordConfirmation:
        return 'Custom Password Confirmation Title';
      default:
        return super.title(context, field);
    }
  }
}


const stringResolver = AuthStringResolver(
  buttons: LocalizedButtonResolver(),
);

final authenticator = Authenticator(
  stringResolver: stringResolver,
  child: const Scaffold(
    body: Center(
      child: Text('You are logged in!'),
    ),
  ),
);
```

#### Setting up internationalization


To use true localiztion, you should carefully follow the steps in the [Flutter Localization guide](https://flutter.dev/docs/development/accessibility-and-localization/internationalization). When the guide says to create an .arb file, enter the following into `lib/l10n/amplify_en.arb`:

```json
{
    "signin": "Sign In - Localized!",
    "@signin": {
        "description": "Label of the button to sign in the user."
    }
}
```

Then, to add Spanish support, create another file at `lib/l10n/amplify_es.arb`, and add the following:

```json
{
    "signin": "Iniciar Sesión"
}
```

Import the following in the `./lib/main.dart` file:

```dart
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:flutter_gen/gen_l10n/app_localizations.dart';
```

Then, update your MaterialApp:
```dart
return MaterialApp(
  title: 'Authenticator Demo',
  theme: ThemeData.light(),
  darkTheme: ThemeData.dark(),
  localizationsDelegates: const [
    AppLocalizations.delegate,
  ],
  supportedLocales: const [
    Locale('en'), // English
    Locale('es'), // Spanish
  ],
  home: authenticator,
);
```

There may be some analysis exceptions in your IDE because, as the Flutter instructions note, Flutter will automatically generate the files at build time.

Your device, assuming it is set to English, should display 'Sign In - Localized' as the Sign In button text. If you change your device language to Spanish, you should see 'Iniciar Sesión'.

## Option 2: Call Authentication APIs manually

Follow the instructions in [Sign In](/lib/auth/signin) to learn about how to integrate these authentication flows in your application with the Auth APIs.

